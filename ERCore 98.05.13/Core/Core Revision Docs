/*********************************************************************************\1.4B15  - INTERNAL ONLY	// LRT - 96/10/27 3:31 PM	Slight modification to "C_Transport" bcEnRouteService for cc:Mail	// LRT - 96/10/27 3:35 PM	Added "__requiresSvcName" slot to "C_Transport" for cc:Mail and others	In the future it may be used in the Validate function to check to	see whether worksite access info is valid. QuickMail required only	that the phone number exist, while cc:Mail needs both a phone number	and a Post Office name.	// LRT - 96/10/27 4:37 PM	Added "connectSlipKids" slot to "C_Transport" for cc:Mail and others	to allow them to extend the connect slip.	// LRT - 96/10/29 2:30 AM	Added an extra space to the core's name in the extras drawer and the	package frame to prevent load conflicts with "EnRoute cc:Mail"	The new name "EnRoute  Core" will load before any other "EnRoute xxx"	files when a reset or card load is performed.1.4B16	// LRT - 96/10/29 10:22 AM	Fixed bug # 1399757	Multiple items were causing problems in the routing slip.	Modified "SetFieldDefaults" in C_RouteSlip to check that fields.title	is a string before calling StrLen.	This will actually not be the same problem any more because of	the following 2 changes which prevent the "_FieldDefaultsSet" flag	from being cleared before the final closing animation.  It was the	final animation sequence causing the routing slip's viewSetupFormScript	to be called by calling :SyncView which triggered the unnecessary	call to "SetFieldDefaults"	// LRT - 96/10/29 10:42 AM	Modified "ShrinkMessage" so that it no longer is responsible for	clearing the "_FieldDefaultsSet" flag.	// LRT - 96/10/29 10:54 AM	Added an override of "ContinueSend" in C_RouteSlip to remove slots	from the mail item which could not be removed earlier.	Specifically, it removes the "_FieldDefaultsSet" flag.	// LRT - 96/10/29 10:32 AM	Made the call to "ConvertInkText" in C_RouteSlip.PrepareToSend	and the call to "ContinueSend" in C_RouteSlip.PrepareToSend2	asynchronous so that the stack wouldn't be so deep.	// LRT - 96/10/29 11:53 AM	Set the connectslipProto slot to NIL in "C_Transport"	Modules now have to create their own version of the connect slip to	function properly.  This may be folded back in later if a scheme can	be determined for addressing all of the differences.	// LRT - 96/10/29 12:25 PM	Modified udScroller.viewSetupFormScript in "Cvd_mTextVDef" to	calculate the scrollAmounts slot differently.  This results in more	manageable scrolling on the N2 platform which was going far too fast	if the scroller was double-tapped.	Changed from [ 1, numVLines div 2, numVLines ]	to [ 1, numVLines div 4, numVLines div 2 ]1.4B17	// LRT - 96/10/29 7:30 PM	Fixed bug # 1398856	Routing slip address pickers now truncate with ellipsis	Problem was NTK telling me that the viewJustify of protoAddressPicker	was different from reality!	Changed to, cc, and bcc pickers' viewBounds.right to -20	// LRT - 96/10/29 8:30 PM	Fixed bug # 1400504	Button name in "Cp_autoDelivBtn" for prefs changed to "Schedule"	// LRT - 96/10/29 9:30 PM	Fixed bug # 1400667	Changed alarm symbol in "Cp_autoDelivBtn" because it was too long	for some transports and prevented the setting of schedule times which	resulted in strings that were too long.  My string was 25 chars for	EnRoute inet but NPG 16-35 says it should be 24 chars max.	Changed to be SPrintObject ( transport.appSymbol )1.4B18	// LRT - 96/10/30 3:40 PM	GetRefForEmail in C_Transport was calling cardFile:bcEmailAddress	with a symbol instead of an array.  Bug was uncovered in EnRoute	for QuickMail so modification was made here as well.1.4B19	// LRT - 96/11/08 12:06 PM	Modified "UnfoldAddressA" in C_Service so that it preserves	the original address to pass back out in case of bad addresses	erDestAddr := { ... orig: addr ... }	// LRT - 96/11/09 3:00 PM	Added creation and modification date slots to the returned enclosure	frame from "ER_PrepEnc" in C_Service	encFrame := { ... creaDate: NEWTON_MINUTES, modiDate: NEWTON_MINUTES ... }	// LRT - 96/11/09 3:00 PM	Added "ConvDateToMac" function to C_Service (from QM's xmodem)	// LRT - 96/11/09 5:05 PM	// BUG - discovered implementing cc:Mail	Fixed "UnfoldAddressA" in C_Service so that it can properly	handle arrays OR frames coming in1.4B21	// LRT - 96/11/17 2:50 PM	Modified C_Service "ER_PrepEnc" function	Improved tests for enough card memory to accomplish flattening of enclosures	Some occasions were encountered where low memory was causing a complete	system freeze during transmission of a package.	Lack of space will now throw |evt.ex.enroute|, -10612 <CARD FULL>	// LRT - 96/11/17 3:20 PM	Error message translate for error code 413 and 414 "send attachment" errors	// LRT - 96/11/17 4:50 PM	Routing slip "Show Text" button re-enabled for packages	// LRT - 96/11/17 9:25 PM	Changed address picker temporary address label from "Temporary Address"	to "Other Address" in Cp_typedAddrPkr1.4B22	// LRT - 96/11/19 5:17 PM	Added "precedence" slot to filters to ensure that simple (fast) filters	can be written such that they will be applied prior to others.	 - Simple Size Filter = 500	 - Rules Filter       = 999   (1.4B20)	// LRT - 96/11/19 5:17 PM	Added "openViewsA" slot to preferences slip to allow tracking of all	subordinate prefs views opened by extensions.	// LRT - 96/11/19 6:45 PM	Added code to viewQuitScript of "Cp_transportPrefs" preferences proto	to close all subordinate slips.	// LRT - 96/11/19 7:17 PM	Fixed "DoInfoAux" function in Core_constants.nh so that it will pass	the actual prefs view to plugins when they are selected from [i]	// LRT - 96/11/19 7:24 PM	Added code in C_Service "FilterRead" to sort transport.filterExtns	based on "precedence" slot.  Filters which have no precedence slot	are treated as if their precedence is 0 (highest)	Switched Open code for Rules Filter Prefs slip to match the scheme used	by standard Newton Formulas app.1.4B23	// LRT - 96/11/28 12:34 PM	Added code to prevent most transport scripts from showing up in the	tag action button when a mail item in the I/O box is a "Log" item.	Fixes many bugs related to logged items which were reported	Bugs:		1601715 - forwarding logged mail		1601713 - reply to logged mail		1601707 - reply to logged mail		1601704 - Copy To Notes for logged mail	// LRT - 96/11/28 1:09 PM	Append "ellipsis" at end of title if truncated in "C_RouteSlipProto"	function "setupTitle" and in "C_RouteSlip" func "PrepareToSend2"	Actually appends 3 periods due to RFC822 character limitations	fields.title := Substr ( fields.title, 0, maxTitleChars-3 ) & "...";	Bug:		1605480 - Need ellipsis at end of truncated subjects	// LRT - 96/11/28 1:09 PM	Set default core message subject length to 61 rather than 31	Bug:		1605476 - complaints about subject truncation to 31 characters	// LRT - 96/11/28 1:09 PM	Strip all but 7-bit chars from title in "C_RouteSlip"	function "PrepareToSend2" after converting RichText	StringFilter ( fields.title, k_Std7BitASCIIChars, 'passAll );	// LRT - 96/11/28 4:17 PM	Improved detection and handling of invalid email addresses from	routing slip when sending.	// LRT - 96/11/28 9:22 PM	// Fix for bug 1601637	Exception |evt.ex.bus| on Newton 2.1 beta unit when switching to	and from custom Monaco font in mail viewDef.	Found another way to refresh the editor window without calling	SetOrigin on a potentially invalid view.	Bug:		1601637 - Changing the email font from Monaco	// LRT - 96/11/30 3:57 PM	Set the progress options icon slot to transport.icon.	It was using an old undefined variable and generated an error -48807	Bug:		1603948 - error putting away large mail text to notes	// LRT - 96/11/30 8:44 PM	Alert user if either owner & worksite info is missing before trying	to connect or submit a mail item from the routing slip.	Bug:		1607896 - error invoked if connecting and no owner has been created1.4B24	// LRT - 96/12/02 11:57 AM	Removed check for missing owner & worksite info from pre-request	code of "SendRequest" and "ReceiveRequest".	Now becomes a requirement of transports to call :VerifyUserConfig()	at the start of their connect slip callback.	Changed notification message to: "Please select ^0 from the sender picker."	which implies that the test should be made from a point where a sender	picker is (or was recently) available.	Bug:		1607896 - error invoked if connecting and no owner has been created1.4B25	// LRT - 96/12/03 3:10 PM	Changes in C_RouteSlipProto functions "GetAttachment", "GenerateText",	and "ChangeFormat"	Re-Address was causing an error trying to access slots in targetView	and activeFormat when these frames were NIL1.4FC01.1	// LRT - 96/12/10 1:34 PM	The "icon" slot is not found again (see earlier bug # 1603948 in 1.4b23)	For some reason "SELF" is now NIL when action picker function is called	and we can't reliably get the icon from the entryView parameter passed in	so I've switched hard-coding the icon now.	Bug:		1611166 - error -48204 when copying to notes1.4FC02	// LRT - 96/12/12 11:31 PM	Solution to the readdress/no TO address "bug" is to skip the alert	when "PrepareToSend" is called with 'readdress	Bug:		1610605 - cannot dismiss replied/forwarded mail slip if no recipient	// LRT - 96/12/13 4:06 AM	Changed appSymbol of Core from "Core:EnRoute:Netstrategy" to	"Core:EnRoute:Netstrategy" in the hope that it might help installer	programs get the order correct.	The package names are already sorted as are the Mac file names.	// LRT - 96/12/13 4:04 AM	No longer allowing core or transport installation on a card1.4FC02.3	// LRT - 96/12/13 3:14 PM	No longer allowing core installation on a card.	Transports seem safe to install on card (only partially tested)	// LRT - 96/12/13 7:21 PM	Added an override of "ClosePrefs" in core prefs proto to prevent	Grip Of Death when transport on a card is removed.	Similar code was added to the Standard prefs viewQuitScript just	in case.	Bug:		1612021 - kicking card out w/ apps causes crash1.4FC02.4	// LRT - 96/12/14 5:01 AM	Modified "viewSetupFormScript" in the EnRoute Letter Text viewDef	This is a fix for the beam viewer not showing the text content of mail	which was beamed.	The beam transport converts the original message which is normally	found by my viewDef in the "fields" variable, into a body-like frame	and it places that body into the "target" variable seen by the viewDef.	Since the viewDef makes extensive use of the "fields" variable, I added	the following code in the viewSetupFormScript to set a local copy of	fields equal to the target. I LOVE NEWTONSCRIPT.	if not ClassOf ( fields ) = kERMailTxtSym	   and ClassOf ( target ) = kERMailTxtSym then			self.fields := target;	This allows us to work with the beam transport's behavior.	Bug:		1603537 - body of mail message lost when beaming from/to MP 2000	Assuming that the bug was that Letter Text was not visible, then this	is definitely the bug fix!	A NOTE ON BEAMING MAIL:	When an email item is beamed to another Newton, the beam transport sends	only the most significant portion of the email item.  If the item contains	an attachment (body slot) then the attachment is beamed.  The receiving	Newton will get only the attachment and will not see any edited text	which was available in the sender's email message even if the original	had the 'edited slot set to true.  To beam the Letter Text, it must first	be copied to the NotePad from which it may then be beamed successfully.	If the source email item was text-only, then the beam transport is	clever enough to convert the entire email frame into the equivalent of	a 'body slot and beam that.  The receiver will be able to view the text	of the message as long as the EnRoute Core (1.4FC02.4+) is installed.1.4FC03.2	// LRT - 96/12/19 1:59 AM	Fixed a bug whereby the RouteSlip proto's viewSetupForm script was calling	GenerateText even when the text already existed for the item.	This caused Re-Address to lose the body text of the message.	I now test that "base.editing" is not set before calling "GenerateText" as	the Apple Readdress code sets that flag before opening the routing slip.	Bug:		1612901 - Body of mail message lost when readdressing "Text Only" notes1.4FC04.1	// LRT - 97/01/03 2:14 PM	Added test for _entryClass = 'group in "C_RouteSlip" function "BadAddress"	to fix bug # ????1.4FC06	// LRT - 97/01/13 1:29 PM	Modified all calls which used StrMunger to clear a string.	Ryan suggested never passing NIL 4th parameter to StrMunger.	Was using:	  StrMunger ( s, x, nil, nil, 0, nil )	Switched to:	  StrMunger ( s, x, nil, k_EmptyString, 0, nil )1.4FC07	// LRT - 97/01/23 6:05 PM	To fix SMTP Forward problem, when forwarding use ">" prefix in "C_Transport:HeaderText"	>Subject: the original subject	>From: the original sender1.4.1a1	// LRT - 97/03/16 2:38 PM	C_RouteSlipProto function "GenerateText"	C_RouteSlipProto function "SetFieldDefaults"	C_RouteSlipProto function "ShrinkMessage"	C_Transport function "VerifyRoutingInfo"	Fix for bug with missing text when mailing from iobox causes loss of message text	Bug:		1629823 - Body of message lost when mailing received/Sent mailed items from the I/O Box	// LRT - 97/03/16 9:43 PM	Fix in C_Transport function "VerifyUserConfig"	Added check for transport slot "__requiresWorksite"	Bug:		1624244 - cannot send mail from a non worksite/homesite location1.4.1a2	// LRT - 97/03/22 4:09 AM	If "Add Sender To Names" can add an address to an existing card it should.	Added code to C_Transport function "TS_NameAdd"	// LRT - 97/03/22 6:20 AM	Extended the plugin architecture for transport.rxExtns	to allow post-itemCompleted message manipulation.	Added code to end of C_Transport function "ItemCompleted"	// LRT - 97/03/23 6:39 PM	Stop using StrFilter on message title in:		C_RouteSlipProto function "SetupTitle"		C_RouteSlip function "PrepareToSend2"		C_RouteSlip Subject picker function "PopIt"	which blindly removed all but 7-bit US-ASCII from the message title.	Allow transports to decide what to do with the title!	Bug:		1640918 - Umlauts omitted from email titles1.4.1a3	// LRT - 97/03/30 2:25 PM	Fix for invented namerefs to fix cc:Mail reply bug	When creating our own nameRef for a raw address, if an existing	name card cannot be found we create a nameRef frame.	Previously we didn't set the class of the new nameRef to anything.	This change adds:		SetClass ( newRef, addressingClass_ER );	to the C_Transport function "GetRefForEMail"	// LRT - 97/03/31 11:22 AM	Fix for "Add Sender To Names" to fix bug where an existing	email address was not seen in Names soup entries if it	was not the 1st email address.		Added Core_funcDefs.nh definition "k_MakeEMailValidTestFunc"			DefConst ( 'k_MakeEMailValidTestFunc, func ( anEmail )				begin				func(e)					begin					if (e.class = 'person or e.class = 'owner) then						begin						if e.email						and StrEqual ( e.email, anEmail ) then							return true;						else if IsArray ( e.emailAddrs ) then							begin							local m;							foreach m in e.emailAddrs do								begin								if m.email								and StrEqual ( m.email, anEmail ) then									return true;								end;							end;						end;					nil;					end;				end );		Modified C_Transport function "GetRefForEMail"			local names  := GetUnionSoup ( ROM_cardfilesoupname );			// LRT - 97/03/31 11:22 AM			// need to use a query which will actually find the			// email address if it's in the "emailAddrs" slot			// WAS:			//local cursor := names:Query ( {type: 'words, words: [anEmail] } );			// NEW:			local cursor := names:Query (				{				validTest: call k_MakeEMailValidTestFunc with (anEmail),				} );		Modified C_Transport function "GetTransportScripts"			local names  := GetUnionSoup ( ROM_cardfilesoupname );			// LRT - 97/03/31 11:22 AM			// need to use a query which will actually find the			// email address if it's in the "emailAddrs" slot			// WAS:			//local cursor := names:Query ( {type: 'words, words: [item.fromRef.email] } );			// NEW:			local cursor := names:Query (				{				validTest: call k_MakeEMailValidTestFunc with (item.fromRef.email),				} );	// LRT - 97/03/31 11:56 AM	Routing slip address check bug fix for non-internet transports which can	only use addresses of their own class.		Modified C_RouteSlipProto function "BadAddress"			// WAS:			//local email := if not IsArray ( addr ) and not addr._entryClass = 'group then			// NEW:			local email := if not transport.__nonInternet and not IsArray ( addr ) and not addr._entryClass = 'group then			// END OF MODIFICATION				begin				transport:NormalizeAddress ( addr );				end;			else				begin				dataDef:Get ( addr, 'email, nil );				end;	// LRT - 97/03/31 12:37 PM	Added code for generic Plugins (Prefs and Tag-Action-Tag) with	a build flag constant for omitting if not approved.		DefConst ( 'k_BUILD_FLAG_ENABLE_GENERIC_PLUGS, nil );1.4.1a4	// LRT - 97/04/01 3:45 PM	Updated version number to synch with 1.4.1a4 of i-net transport1.4.1a5	// LRT - 97/04/01 8:33 PM	Changed code to be ready for localization of the missing	German "multiple items" message. (for bug 1643190)	NOTE:		I still have to receive the translated text for this.	Modified code:		C_RouteSlip's Subject textPicker function "PopIt"			// LRT - 97/04/01 8:33 PM			// localize, elaborate on message text,			// and switch from "kNotifyAlert" to "kNotifyMessage"			// WAS:			//:Notify ( kNotifyAlert, appName,			//	"The Subject for multiple items can't be changed here." );			// NEW:			:Notify ( kNotifyMessage, appName,				LocObj (					"The Subject for multiple items cannot be changed here.\n\nPlease use the Out Box to change each Subject seperately.",					'routeSlip.multiNoChange ) );	// LRT - 97/04/01 10:43 PM	Fixed bug which was causing a throw in the mail viewer header.	This was caused by some received broadcast messages having no toRef.	Bug:		1642122 - Tapping on mail viewer header icon causes throw accessing toRef	Modified code:		C_TransportInfo function "BuildText"			// WAS:			//if Length ( target.toRef ) > 0			//or Length ( target.cc    ) > 0 then			// NEW:			if (target.toRef and Length ( target.toRef ) > 0 )			or (target.cc    and Length ( target.cc    ) > 0 ) then1.4.1a6	// LRT - 97/04/03 11:56 PM	Fixed German strings for core Standard Prefs		stdPrefs:{			logChoiceLog: "Protokoll",			// LRT - 97/04/03   WAS: "Protokollieren",			routeChoiceWhen: "Zeit festlegen",	// LRT - 97/04/03   WAS: "Zeitpunkt festlegen",			rxThenDisconnect: "Abbrechen",		// LRT - 97/04/03   WAS: "Verbindung abbrechen",			txThenDisconnect: "Abbrechen",		// LRT - 97/04/03   WAS: "Verbindung abbrechen",	Bug:		1642017 - German Preferences - long choices	// LRT - 97/04/03 11:56 PM	Cross-referenced 1.4.1a2 bugFix (LRT - 97/03/23 6:39 PM) to the correct	radar bug number.	Bug:		1640918 - Umlauts omitted from email titles	// LRT - 97/04/04 12:32 AM	To make certain that the routing slip's mail button hilite is removed when	the proto sometimes fails to do the job, I deliberately unhilite "sendButton"		Modified C_RouteSlip function "PrepareToSend"			// LRT - 97/04/04 12:32 AM			// Prevent stuck hilite if an error stops the slip from			// closing when "noworlater" is set to 'now or 'later			// but don't touch hilite if set to NIL (now or later)			if transport:GetConfig ( 'noworlater ) then				AddDelayedSend ( sendButton, 'Hilite, [ nil ], 1 );	Bug:		1643804 - Mail button remains highlighted with "When mailing Send now"1.4.1a7	Resolved problem with missing build flag (in German only) from 1.4.1a6	Bug:		1645214 - <German> Error (-48807) when tapping the Tag button or Info button		Status: VALIDATE1.4.1a8	// LRT - 97/04/11 5:17 AM	Changed translation text from "Nur lesen" to "Nur gelesen Objekte"	Bug:		1645974 - Konfig. option "Nur lesen" should be "Nur gelesene Objekte"	// LRT - 97/04/11 5:33 AM	Changed Core function "k_BuildDTStrFunc" to not rely on Newton OS to build	the standard RFC-822 Date string which is specified as an ENGLISH date and	must not be localized!	// LRT - 97/04/12 1:11 AM	Removed 1.4.1a3 fix (97/03/31 11:22 AM) for secondary email addresses.	Additional overhead of more complex email address search is slowing	transport's <x] action tag pick list generation when names soup is large.	Bug:		1647011 - it takes up to 5 sec to open menu when tapping Tag button 1.4.1a9	// LRT - 97/04/15 12:17 PM	Version number synched with i-net component1.4.1a10	// LRT - 97/04/17 11:41 PM	Removed 1.4.1a6 fix for button hilite behavior.	Apr 14 1997 11:31AM Yannick Bertolus:	Les, please remove the fix...  We'll defer the bug (harmless to the user),	following the project team's guidelines.	Bug:		1643804 - Mail button remains highlighted	// LRT - 97/04/17 11:58 PM	Changed text of preference picker from "Nur gelesen Objekte"	to "Nur gelesene" which fixes the spelling error I made, and also	allows the picker viewbounds to be a little narrower.	Bug:		1644778 - wrong read of "read" translated		1645974 - Konfig. option "Nur lesen" should be "Nur gelesene Objekte"1.4.1a11	// LRT - 97/04/22 8:49 PM	Changed localization string for "Subject for multiple items..."	Bug:		1643190	// LRT - 97/04/23 1:46 AM	************	INTERNAL DOC	************	Allow the "To", "CC", and "BCC" popups in the message info view to also work	when viewing outbox items.	This was suggested by Leslie Murphey <Les_Murphy@Compuware.com> who uses	the "Reply to All" feature and wants to be able to easliy look at the address	list for the message recipients.	> Date: Sat, 19 Apr 1997 10:52:53 -0400	> From: Leslie and Marci Murphy <llmurphy@prodigy.net>	> Way to see the entire distribution list when replying to All on a	> message with many receipients.		Modified C_transportInfo function "BuildText"			// NEW:			addedHeight := 88;			// WAS:			// lengthy code to place text-only equivalent for to, cc, and bcc	// LRT - 97/04/23 3:25 AM	************	INTERNAL DOC	************	Modified the hidden about box feature which used to clear the last known server	and phone info so that it clears the popup list of the "to" "CC" and "BCC"	pickers instead.	1) Tap in upper-left of about box	2) Tap in upper-right of about box	3) Tap in upper-left of about box	4) Tap OK in the slip which appears.		Modified C_About child "clear1" function "AskClear"1.4.1a2	// LRT - 97/04/30 3:06 AM	Changed German text for ink conversion.		WAS:			"Bitte stellen Sie sicher, daß die elektronische Tinte korrekt konvertiert wurde.",		NEW:			"Bitte prüfen Sie, ob die elektronische Tinte korrekt umgesetzt wurde.",1.4.1FC01	// LRT - 97/05/09 2:54 AM	Version number change only1.4.1FC02	// LRT - 97/04/01 8:33 PM	Replaced inadvertant use of "kNotifyMessage" constant in notification	call to "kNotifyQAlert" which I'd originally intended to use.	This once again allows the message to be visible instead of being available	only after tapping on the "blinking star."	BUG:		1643190 - Message for "The Subject for multiple items..."	Modified code:		C_RouteSlip's Subject textPicker function "PopIt"		// LRT - 97/05/21 1:30 PM		// switch from "kNotifyMessage" to "kNotifyQAlert"		:Notify ( kNotifyQAlert, appName,				LocObj (					"The Subject for multiple items cannot be changed here.\n\nPlease use the Out Box to change each Subject seperately.",					'routeSlip.multiNoChange ) );	// LRT - 97/05/23 2:14 AM	Changed the algorithm used when relocating packages to correct potential problem	encountered when sending.	BUG:		1643190 - Message for "The Subject for multiple items..."	Modified code:		C_RouteSlip's Subject textPicker function "PopIt"			// WAS:			//local dest := ExtractBytes ( reloFix, 0, 16, 'binary );			// NEW:			local dest := ExtractBytes ( reloFix, i, 12, 'binary );1.4.2FC03	C_Service function ER_PrepEnc	// LRT - 97/09/05 12:59 AM	// Adding handler for app-specific MIME part	else if ClassOf ( boxItem.body ) = 'enRouteMIME	...		encFrame :=			{			class:	'enRouteMIME,			};		encFrame.data     := boxItem.body.data;		encFrame.headers  := boxItem.body.headers;		encFrame.encoding := boxItem.body.encoding;		encFrame.text     := boxItem.body.text;		// msg body text1.4.2FC04	C_Service function ER_PrepEnc	// LRT - 97/09/16 5:55 AM	// Adding handler for app-specific MIME part	// which has a body slot called 'enRouteMIME	else if HasSlot ( boxItem.body, 'enRouteMIME )	...		encFrame :=			{			class:	'enRouteMIME,			};		encFrame.data     := boxItem.body.enRouteMIME.data;		encFrame.headers  := boxItem.body.enRouteMIME.headers;		encFrame.encoding := boxItem.body.enRouteMIME.encoding;		encFrame.text     := boxItem.body.text;		// msg body textTO DO:	// LRT - 97/06/21 6:06 PM	Located a bug in "C_RouteSlipProt" function "ChangeFormat" which	causes Re-Address to lose the content of 'routeBinary messages	Target is the original "body" from the ioBox entry but fields	doesn't have any "activeFormat" slot.\*********************************************************************************/